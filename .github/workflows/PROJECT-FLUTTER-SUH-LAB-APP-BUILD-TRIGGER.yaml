# ===================================================================
# Flutter í…ŒìŠ¤íŠ¸ ì•± ë¹Œë“œ íŠ¸ë¦¬ê±° ì›Œí¬í”Œë¡œìš° (SUH-LAB)
# ===================================================================
#
# ì´ ì›Œí¬í”Œë¡œìš°ëŠ” PR ë˜ëŠ” ì´ìŠˆì— ëŒ“ê¸€ë¡œ ë¹Œë“œ ëª…ë ¹ì–´ë¥¼ ì‘ì„±í•˜ë©´
# Androidì™€ iOS í…ŒìŠ¤íŠ¸ ì•± ë¹Œë“œë¥¼ ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.
#
# ì£¼ìš” íŠ¹ì§•:
# - PR/ì´ìŠˆ ëŒ“ê¸€ ê°ì§€: "@suh-lab build app/apk build/ios build" í‚¤ì›Œë“œ ê°ì§€
# - repository_dispatch ì´ë²¤íŠ¸ë¡œ ë¹Œë“œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
# - PR/ì´ìŠˆ ë²ˆí˜¸ + ë¹Œë“œ íšŸìˆ˜ë¡œ ê³ ìœ í•œ ë¹Œë“œ ë²ˆí˜¸ ìƒì„± (ì˜ˆ: 38700, 38701...)
# - ë¸Œëœì¹˜ëª…ì—ì„œ ì´ìŠˆ ë²ˆí˜¸ ìë™ ì¶”ì¶œ (YYYYMMDD_#ì´ìŠˆë²ˆí˜¸_ë‚´ìš© í˜•ì‹)
# - í…ŒìŠ¤íŠ¸ ë²„ì „ 0.0.0 ê³ ì •ìœ¼ë¡œ ìš´ì˜ ë²„ì „ê³¼ ë¶„ë¦¬
#
# ì‚¬ìš© ë°©ë²•:
# - PRì— ëŒ“ê¸€ ì‘ì„±: "@suh-lab build app" (Android + iOS ëª¨ë‘ ë¹Œë“œ)
# - PRì— ëŒ“ê¸€ ì‘ì„±: "@suh-lab apk build" (Androidë§Œ ë¹Œë“œ)
# - PRì— ëŒ“ê¸€ ì‘ì„±: "@suh-lab ios build" (iOSë§Œ ë¹Œë“œ)
# - ì´ìŠˆì— ëŒ“ê¸€ ì‘ì„±: ìœ„ ëª…ë ¹ì–´ ë™ì¼ (Guide by SUH-LAB ëŒ“ê¸€ í•„ìš”)
#
# íŠ¸ë¦¬ê±°ë˜ëŠ” ì›Œí¬í”Œë¡œìš°:
# - PROJECT-FLUTTER-ANDROID-TEST-APK.yaml (event_type: build-android-app)
# - PROJECT-FLUTTER-IOS-TEST-TESTFLIGHT.yaml (event_type: build-ios-app)
#
# ===================================================================

name: PROJECT-Flutter-SUH-LAB-App-Build-Trigger

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  trigger-builds:
    name: ë¹Œë“œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
    # @suh-lab build app / @suh-lab apk build / @suh-lab ios build í‚¤ì›Œë“œ ê°ì§€
    if: |
      contains(github.event.comment.body, '@suh-lab') &&
      (
        (contains(github.event.comment.body, 'build') && contains(github.event.comment.body, 'app')) ||
        (contains(github.event.comment.body, 'apk') && contains(github.event.comment.body, 'build')) ||
        (contains(github.event.comment.body, 'ios') && contains(github.event.comment.body, 'build'))
      )
    runs-on: ubuntu-latest

    steps:
      - name: ëŒ“ê¸€ì— ğŸ‘€ ë¦¬ì•¡ì…˜ ì¶”ê°€
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const commentId = context.payload.comment.id;

            await github.rest.reactions.createForIssueComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              comment_id: commentId,
              content: 'eyes'
            });

            console.log('ğŸ‘€ ëŒ“ê¸€ì— í™•ì¸ ë¦¬ì•¡ì…˜ ì¶”ê°€ ì™„ë£Œ');

      - name: ë¹Œë“œ íƒ€ì… íŒë³„
        id: build_type
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const comment = context.payload.comment.body.toLowerCase();

            let buildAndroid = false;
            let buildIos = false;
            let buildType = '';

            if (comment.includes('build') && comment.includes('app')) {
              // @suh-lab build app â†’ ì–‘ìª½ ëª¨ë‘
              buildAndroid = true;
              buildIos = true;
              buildType = 'app';
            } else if (comment.includes('apk') && comment.includes('build')) {
              // @suh-lab apk build â†’ Androidë§Œ
              buildAndroid = true;
              buildType = 'apk';
            } else if (comment.includes('ios') && comment.includes('build')) {
              // @suh-lab ios build â†’ iOSë§Œ
              buildIos = true;
              buildType = 'ios';
            }

            core.setOutput('buildAndroid', buildAndroid.toString());
            core.setOutput('buildIos', buildIos.toString());
            core.setOutput('buildType', buildType);

            console.log(`ğŸ“± ë¹Œë“œ íƒ€ì…: ${buildType} (Android=${buildAndroid}, iOS=${buildIos})`);

      - name: PR/ì´ìŠˆ ì •ë³´ í™•ì¸ ë° ì¶”ì¶œ
        id: source_info
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issueNumber = context.payload.issue.number;
            let sourceType = '';
            let sourceNumber = '';
            let branchName = '';
            let headSha = '';
            let relatedIssueNumber = '';

            // 1. ë¨¼ì € PRì¸ì§€ í™•ì¸
            try {
              const pr = await github.rest.pulls.get({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: issueNumber
              });

              sourceType = 'PR';
              sourceNumber = pr.data.number.toString();
              branchName = pr.data.head.ref;
              headSha = pr.data.head.sha;

              console.log(`âœ… PR í™•ì¸: #${sourceNumber}`);
              console.log(`ğŸŒ¿ ë¸Œëœì¹˜ëª…: ${branchName}`);
              console.log(`ğŸ“ ì»¤ë°‹ í•´ì‹œ: ${headSha}`);

              // ë¸Œëœì¹˜ëª…ì—ì„œ ì´ìŠˆ ë²ˆí˜¸ ì¶”ì¶œ (#280 í˜•ì‹)
              const issueMatch = branchName.match(/#(\d+)/);
              relatedIssueNumber = issueMatch ? issueMatch[1] : '';

              if (relatedIssueNumber) {
                console.log(`ğŸ“Œ ì¶”ì¶œëœ ì´ìŠˆ ë²ˆí˜¸: #${relatedIssueNumber}`);
              }

            } catch (error) {
              console.log('â„¹ï¸ PRì´ ì•„ë‹™ë‹ˆë‹¤. ì´ìŠˆì—ì„œ ë¸Œëœì¹˜ ì •ë³´ë¥¼ ì°¾ìŠµë‹ˆë‹¤...');

              // 2. PRì´ ì•„ë‹ˆë©´ ì´ìŠˆì—ì„œ "Guide by SUH-LAB" ëŒ“ê¸€ ì°¾ê¸°
              sourceType = 'ISSUE';
              sourceNumber = issueNumber.toString();
              relatedIssueNumber = issueNumber.toString();

              try {
                const comments = await github.rest.issues.listComments({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issueNumber,
                  per_page: 100
                });

                // "Guide by SUH-LAB" ëŒ“ê¸€ ì°¾ê¸°
                const guideComment = comments.data.find(c =>
                  c.body.includes('Guide by SUH-LAB')
                );

                if (!guideComment) {
                  console.log('âŒ "Guide by SUH-LAB" ëŒ“ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                  core.setOutput('found', 'false');
                  core.setOutput('errorMessage', 'ì´ìŠˆì—ì„œ "Guide by SUH-LAB" ëŒ“ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œëœì¹˜ ì •ë³´ê°€ í¬í•¨ëœ ëŒ“ê¸€ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                  return;
                }

                console.log('âœ… "Guide by SUH-LAB" ëŒ“ê¸€ ë°œê²¬');

                // ë¸Œëœì¹˜ëª… ì¶”ì¶œ (### ë¸Œëœì¹˜ ë‹¤ìŒ ``` ë¸”ë¡ ë‚´ìš©)
                const branchMatch = guideComment.body.match(/### ë¸Œëœì¹˜\s*```\s*([\s\S]*?)\s*```/);

                if (!branchMatch) {
                  console.log('âŒ ë¸Œëœì¹˜ ì •ë³´ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                  core.setOutput('found', 'false');
                  core.setOutput('errorMessage', '"Guide by SUH-LAB" ëŒ“ê¸€ì—ì„œ ë¸Œëœì¹˜ ì •ë³´ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëŒ“ê¸€ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                  return;
                }

                branchName = branchMatch[1].trim();
                console.log(`ğŸŒ¿ ì¶”ì¶œëœ ë¸Œëœì¹˜ëª…: ${branchName}`);
                console.log(`âœ… ì´ìŠˆ #${sourceNumber}ì—ì„œ ë¹Œë“œ ì •ë³´ ì¶”ì¶œ ì™„ë£Œ`);

              } catch (commentError) {
                console.log('âŒ ì´ìŠˆ ëŒ“ê¸€ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', commentError.message);
                core.setOutput('found', 'false');
                core.setOutput('errorMessage', `ì´ìŠˆ ëŒ“ê¸€ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${commentError.message}`);
                return;
              }
            }

            // ê²°ê³¼ ì¶œë ¥
            core.setOutput('found', 'true');
            core.setOutput('sourceType', sourceType);
            core.setOutput('sourceNumber', sourceNumber);
            core.setOutput('branchName', branchName);
            core.setOutput('headSha', headSha);
            core.setOutput('relatedIssueNumber', relatedIssueNumber);

      - name: ë¸Œëœì¹˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš° ì—ëŸ¬ ëŒ“ê¸€ ì‘ì„±
        if: steps.source_info.outputs.found != 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issueNumber = context.payload.issue.number;
            const errorMessage = '${{ steps.source_info.outputs.errorMessage }}';

            const body = `âŒ **ì•± ë¹Œë“œ íŠ¸ë¦¬ê±° ì‹¤íŒ¨**

            ${errorMessage}

            **í•´ê²° ë°©ë²•:**
            - PRì—ì„œ ë¹Œë“œí•˜ëŠ” ê²½ìš°: PR í˜ì´ì§€ì—ì„œ ëŒ“ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
            - ì´ìŠˆì—ì„œ ë¹Œë“œí•˜ëŠ” ê²½ìš°: "Guide by SUH-LAB" ëŒ“ê¸€ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
              - ëŒ“ê¸€ì— \`### ë¸Œëœì¹˜\` ì„¹ì…˜ê³¼ ë¸Œëœì¹˜ëª…ì´ í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: body
            });

            core.setFailed(errorMessage);

      - name: ë¸Œëœì¹˜ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        id: check_branch
        if: steps.source_info.outputs.found == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const branchName = '${{ steps.source_info.outputs.branchName }}';
            const runId = '${{ github.run_id }}';
            const runUrl = `https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${runId}`;

            console.log(`ğŸ” ë¸Œëœì¹˜ ì¡´ì¬ ì—¬ë¶€ í™•ì¸: ${branchName}`);

            try {
              await github.rest.repos.getBranch({
                owner: context.repo.owner,
                repo: context.repo.repo,
                branch: branchName
              });
              console.log(`âœ… ë¸Œëœì¹˜ ì¡´ì¬ í™•ì¸ë¨: ${branchName}`);
              core.setOutput('exists', 'true');
            } catch (error) {
              if (error.status === 404) {
                console.log(`âŒ ë¸Œëœì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${branchName}`);
                core.setOutput('exists', 'false');
                core.setOutput('errorMessage', `ë¸Œëœì¹˜ \`${branchName}\`ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
              } else {
                console.log(`âŒ ë¸Œëœì¹˜ í™•ì¸ ì¤‘ ì˜¤ë¥˜: ${error.message}`);
                core.setOutput('exists', 'false');
                core.setOutput('errorMessage', `ë¸Œëœì¹˜ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
              }
            }

      - name: ë¸Œëœì¹˜ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì—ëŸ¬ ëŒ“ê¸€ ì‘ì„±
        if: steps.source_info.outputs.found == 'true' && steps.check_branch.outputs.exists == 'false'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issueNumber = context.payload.issue.number;
            const branchName = '${{ steps.source_info.outputs.branchName }}';
            const runId = '${{ github.run_id }}';
            const runUrl = `https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${runId}`;

            const body = [
              'âŒ **ì•± ë¹Œë“œ íŠ¸ë¦¬ê±° ì‹¤íŒ¨ - ë¸Œëœì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤**',
              '',
              '| í•­ëª© | ê°’ |',
              '|------|-----|',
              `| **ìš”ì²­ëœ ë¸Œëœì¹˜** | \`${branchName}\` |`,
              `| **ì´ìŠˆ/PR** | #${issueNumber} |`,
              '',
              '### ğŸ’¡ í™•ì¸ ì‚¬í•­',
              '1. ë¸Œëœì¹˜ê°€ ì›ê²© ì €ì¥ì†Œì— pushë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”',
              '2. "Guide by SUH-LAB" ëŒ“ê¸€ì˜ ë¸Œëœì¹˜ëª…ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”',
              '3. ë¸Œëœì¹˜ëª…ì— ì˜¤íƒ€ê°€ ì—†ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”',
              '',
              `ğŸ”— [ì›Œí¬í”Œë¡œìš° ë¡œê·¸](${runUrl})`
            ].join('\n');

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: body
            });

            core.setFailed(`ë¸Œëœì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${branchName}`);

      - name: ë¹Œë“œ íšŸìˆ˜ ì¡°íšŒ ë° ë¹Œë“œ ë²ˆí˜¸ ìƒì„±
        id: build_number_calc
        if: steps.source_info.outputs.found == 'true' && steps.check_branch.outputs.exists == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const sourceNumber = parseInt('${{ steps.source_info.outputs.sourceNumber }}');
            const sourceType = '${{ steps.source_info.outputs.sourceType }}';
            const buildType = '${{ steps.build_type.outputs.buildType }}';

            console.log(`ğŸ“Š ${sourceType} #${sourceNumber}ì˜ ë¹Œë“œ íšŸìˆ˜ ì¡°íšŒ ì¤‘...`);
            console.log(`ğŸ“± ë¹Œë“œ íƒ€ì…: ${buildType}`);

            // PR/ì´ìŠˆì˜ ëª¨ë“  ëŒ“ê¸€ ì¡°íšŒ
            const comments = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: sourceNumber,
              per_page: 100
            });

            // ë¹Œë“œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹í•˜ëŠ” ì™„ë£Œ ëŒ“ê¸€ë§Œ ì¹´ìš´íŠ¸ (í”Œë«í¼ë³„ ë¶„ë¦¬)
            let searchKeyword = '';
            if (buildType === 'app') {
              searchKeyword = 'ì•± ë¹Œë“œ íŠ¸ë¦¬ê±° ì™„ë£Œ';
            } else if (buildType === 'apk') {
              searchKeyword = 'APK ë¹Œë“œ íŠ¸ë¦¬ê±° ì™„ë£Œ';
            } else if (buildType === 'ios') {
              searchKeyword = 'iOS ë¹Œë“œ íŠ¸ë¦¬ê±° ì™„ë£Œ';
            }

            const buildCount = comments.data.filter(c =>
              c.body.includes(searchKeyword)
            ).length;

            // ë¹Œë“œ ë²ˆí˜¸: ì†ŒìŠ¤ë²ˆí˜¸ + 2ìë¦¬ ì¹´ìš´íŠ¸ (38800, 38801, 38802...)
            const buildNumber = `${sourceNumber}${String(buildCount).padStart(2, '0')}`;

            console.log(`ğŸ“Š ì¹´ìš´íŠ¸ í‚¤ì›Œë“œ: "${searchKeyword}"`);
            console.log(`ğŸ“Š ${sourceType} #${sourceNumber}: ${buildType} ${buildCount}ë²ˆì§¸ ë¹Œë“œ`);
            console.log(`ğŸ“¦ ìƒì„±ëœ ë¹Œë“œ ë²ˆí˜¸: ${buildNumber}`);

            core.setOutput('buildCount', buildCount.toString());
            core.setOutput('buildNumber', buildNumber);

      - name: Android ë¹Œë“œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
        if: |
          steps.source_info.outputs.found == 'true' &&
          steps.check_branch.outputs.exists == 'true' &&
          steps.build_type.outputs.buildAndroid == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const sourceType = '${{ steps.source_info.outputs.sourceType }}';
            const sourceNumber = '${{ steps.source_info.outputs.sourceNumber }}';
            const branchName = '${{ steps.source_info.outputs.branchName }}';
            const relatedIssueNumber = '${{ steps.source_info.outputs.relatedIssueNumber }}';
            const buildNumber = '${{ steps.build_number_calc.outputs.buildNumber }}';

            console.log(`ğŸš€ Android ë¹Œë“œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° ì‹œì‘...`);
            console.log(`   ${sourceType} ë²ˆí˜¸: #${sourceNumber}`);
            console.log(`   ë¹Œë“œ ë²ˆí˜¸: ${buildNumber}`);
            console.log(`   ë¸Œëœì¹˜: ${branchName}`);
            console.log(`   ê´€ë ¨ ì´ìŠˆ ë²ˆí˜¸: ${relatedIssueNumber || 'ì—†ìŒ'}`);

            await github.rest.repos.createDispatchEvent({
              owner: context.repo.owner,
              repo: context.repo.repo,
              event_type: 'build-android-app',
              client_payload: {
                pr_number: sourceNumber,
                build_number: buildNumber,
                branch_name: branchName,
                issue_number: relatedIssueNumber || '',
                triggered_by: `${sourceType.toLowerCase()}-comment`,
                comment_id: context.payload.comment.id.toString(),
                source_type: sourceType
              }
            });

            console.log('âœ… Android ë¹Œë“œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° ì™„ë£Œ');

      - name: iOS ë¹Œë“œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
        if: |
          steps.source_info.outputs.found == 'true' &&
          steps.check_branch.outputs.exists == 'true' &&
          steps.build_type.outputs.buildIos == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const sourceType = '${{ steps.source_info.outputs.sourceType }}';
            const sourceNumber = '${{ steps.source_info.outputs.sourceNumber }}';
            const branchName = '${{ steps.source_info.outputs.branchName }}';
            const relatedIssueNumber = '${{ steps.source_info.outputs.relatedIssueNumber }}';
            const buildNumber = '${{ steps.build_number_calc.outputs.buildNumber }}';

            console.log(`ğŸš€ iOS ë¹Œë“œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° ì‹œì‘...`);
            console.log(`   ${sourceType} ë²ˆí˜¸: #${sourceNumber}`);
            console.log(`   ë¹Œë“œ ë²ˆí˜¸: ${buildNumber}`);
            console.log(`   ë¸Œëœì¹˜: ${branchName}`);
            console.log(`   ê´€ë ¨ ì´ìŠˆ ë²ˆí˜¸: ${relatedIssueNumber || 'ì—†ìŒ'}`);

            await github.rest.repos.createDispatchEvent({
              owner: context.repo.owner,
              repo: context.repo.repo,
              event_type: 'build-ios-app',
              client_payload: {
                pr_number: sourceNumber,
                build_number: buildNumber,
                branch_name: branchName,
                issue_number: relatedIssueNumber || '',
                triggered_by: `${sourceType.toLowerCase()}-comment`,
                comment_id: context.payload.comment.id.toString(),
                source_type: sourceType
              }
            });

            console.log('âœ… iOS ë¹Œë“œ ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° ì™„ë£Œ');

      - name: íŠ¸ë¦¬ê±° ì™„ë£Œ ëŒ“ê¸€ ì‘ì„±
        if: steps.source_info.outputs.found == 'true' && steps.check_branch.outputs.exists == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const sourceType = '${{ steps.source_info.outputs.sourceType }}';
            const sourceNumber = '${{ steps.source_info.outputs.sourceNumber }}';
            const branchName = '${{ steps.source_info.outputs.branchName }}';
            const buildNumber = '${{ steps.build_number_calc.outputs.buildNumber }}';
            const buildCount = '${{ steps.build_number_calc.outputs.buildCount }}';
            const buildType = '${{ steps.build_type.outputs.buildType }}';

            // ë¹Œë“œ íƒ€ì…ì— ë”°ë¼ ì™„ë£Œ ë©”ì‹œì§€ ê²°ì • (í”Œë«í¼ë³„ ë¶„ë¦¬)
            let triggerTypeText = '';
            let platformText = '';

            if (buildType === 'app') {
              triggerTypeText = 'ì•± ë¹Œë“œ íŠ¸ë¦¬ê±° ì™„ë£Œ';
              platformText = 'Androidì™€ iOS';
            } else if (buildType === 'apk') {
              triggerTypeText = 'APK ë¹Œë“œ íŠ¸ë¦¬ê±° ì™„ë£Œ';
              platformText = 'Android';
            } else if (buildType === 'ios') {
              triggerTypeText = 'iOS ë¹Œë“œ íŠ¸ë¦¬ê±° ì™„ë£Œ';
              platformText = 'iOS';
            }

            const body = [
              `ğŸš€ **${triggerTypeText}**`,
              '',
              `${platformText} ë¹Œë“œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.`,
              '',
              `- ì•± ë²„ì „: \`0.0.0(${buildNumber})\``,
              `- PR/ISSUE: **#${sourceNumber}** (${buildType} ${buildCount}ë²ˆì§¸ ë¹Œë“œ)`,
              `- ë¸Œëœì¹˜: \`${branchName}\``,
              '',
              'â³ ë¹Œë“œê°€ ì™„ë£Œë˜ë©´ ìë™ìœ¼ë¡œ ê²°ê³¼ ëŒ“ê¸€ì´ ì‘ì„±ë©ë‹ˆë‹¤.'
            ].join('\n');

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: parseInt(sourceNumber),
              body: body
            });

            console.log(`âœ… ${triggerTypeText} ëŒ“ê¸€ ì‘ì„± ì™„ë£Œ`);
