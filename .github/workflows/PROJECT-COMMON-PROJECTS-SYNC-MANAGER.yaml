# ===================================================================
# GitHub Projects ìë™ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°
# ===================================================================
#
# ì´ ì›Œí¬í”Œë¡œìš°ëŠ” GitHub Issueì™€ Projectsë¥¼ ìë™ìœ¼ë¡œ ë™ê¸°í™”í•©ë‹ˆë‹¤.
#
# ì‘ë™ ë°©ì‹:
# 1. Issue ìƒì„± ì‹œ ìë™ìœ¼ë¡œ í”„ë¡œì íŠ¸ì— ì¶”ê°€ (PRì€ ì˜µì…˜)
# 2. Issue Label ë³€ê²½ ì‹œ Projects Status ìë™ ë™ê¸°í™”
# 3. Issue ë‹«ê¸° ì‹œ Projects Statusë¥¼ "ì‘ì—… ì™„ë£Œ"ë¡œ ìë™ ë³€ê²½ (PRì€ ì˜µì…˜)
#
# ì§€ì› ê¸°ëŠ¥:
# - Issue ìƒì„± â†’ í”„ë¡œì íŠ¸ ìë™ ì¶”ê°€ (ê¸°ë³¸ Status: "ì‘ì—… ì „")
# - PR ìƒì„± â†’ í”„ë¡œì íŠ¸ ìë™ ì¶”ê°€ (ì˜µì…˜, ê¸°ë³¸ê°’: ë¹„í™œì„±í™”)
# - Label ë³€ê²½ â†’ Projects Status ì‹¤ì‹œê°„ ë™ê¸°í™” (Issueë§Œ ì§€ì›)
#   â€¢ ì‘ì—… ì „ â†’ ì‘ì—… ì „
#   â€¢ ì‘ì—… ì¤‘ â†’ ì‘ì—… ì¤‘
#   â€¢ í™•ì¸ ëŒ€ê¸° â†’ í™•ì¸ ëŒ€ê¸°
#   â€¢ í”¼ë“œë°± â†’ í”¼ë“œë°±
#   â€¢ ì‘ì—… ì™„ë£Œ â†’ ì‘ì—… ì™„ë£Œ
#   â€¢ ì·¨ì†Œ â†’ ì·¨ì†Œ
# - Issue ë‹«ê¸° â†’ "ì‘ì—… ì™„ë£Œ" Status ìë™ ì„¤ì •
# - PR ë‹«ê¸° â†’ "ì‘ì—… ì™„ë£Œ" Status ìë™ ì„¤ì • (ì˜µì…˜, ê¸°ë³¸ê°’: ë¹„í™œì„±í™”)
# - ì—¬ëŸ¬ Status Label ë™ì‹œ ì¡´ì¬ ì‹œ ìš°ì„ ìˆœìœ„ ì •ì±… ì ìš©
#
# Label ìš°ì„ ìˆœìœ„:
# ì‘ì—… ì™„ë£Œ > ì·¨ì†Œ > í”¼ë“œë°± > í™•ì¸ ëŒ€ê¸° > ì‘ì—… ì¤‘ > ì‘ì—… ì „
#
# í•„ìˆ˜ ì„¤ì •:
# - Organization Secret: _GITHUB_PAT_TOKEN (ëª¨ë“  ì‘ì—…ì— ì‚¬ìš©)
#   â€¢ í•„ìš” ê¶Œí•œ: repo (ì „ì²´), project (read:project, write:project)
#   â€¢ Classic PAT í•„ìš” (Fine-grained tokenì€ GraphQL API ë¯¸ì§€ì›)
#
# í™˜ê²½ë³€ìˆ˜ ì„¤ì •:
# - PROJECT_URL: GitHub Projects URL (í•„ìˆ˜)
# - STATUS_FIELD: Projectsì˜ Status í•„ë“œëª… (ê¸°ë³¸ê°’: "Status")
# - ENABLE_PR_AUTO_ADD: PR ìƒì„± ì‹œ í”„ë¡œì íŠ¸ ìë™ ì¶”ê°€ (ê¸°ë³¸ê°’: false)
# - ENABLE_PR_AUTO_CLOSE: PR ë‹«ê¸° ì‹œ ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ (ê¸°ë³¸ê°’: false)
# - STATUS_PRIORITY: Status Label ìš°ì„ ìˆœìœ„ (JSON ë°°ì—´, ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥)
# - DONE_STATUS: Issue/PR ë‹«ê¸° ì‹œ ì„¤ì •í•  Status (ê¸°ë³¸ê°’: "ì‘ì—… ì™„ë£Œ")
# - DEFAULT_STATUS: Issue ìƒì„± ì‹œ ê¸°ë³¸ Status (ê¸°ë³¸ê°’: "ì‘ì—… ì „", ì„ íƒì )
#
# ì‚¬ìš© ì˜ˆì‹œ:
# - Issueë§Œ ìë™í™”: ê¸°ë³¸ ì„¤ì • ì‚¬ìš© (ë³€ê²½ ë¶ˆí•„ìš”)
# - PRë„ ìë™í™”: ENABLE_PR_AUTO_ADDì™€ ENABLE_PR_AUTO_CLOSEë¥¼ trueë¡œ ë³€ê²½
# - Status ìš°ì„ ìˆœìœ„ ë³€ê²½: STATUS_PRIORITY JSON ë°°ì—´ ìˆ˜ì •
#
# ===================================================================

name: PROJECT-COMMON-PROJECTS-SYNC-MANAGER

on:
  issues:
    types: [opened, labeled, unlabeled, closed]
  pull_request:
    types: [opened, closed]

# ===================================================================
# ì„¤ì • ë³€ìˆ˜
# ===================================================================
env:
  PROJECT_URL: https://github.com/orgs/TEAM-ROMROM/projects/6
  STATUS_FIELD: Status

  # PR ìë™í™” ì˜µì…˜ (ê¸°ë³¸ê°’: false - Issueë§Œ ì²˜ë¦¬)
  ENABLE_PR_AUTO_ADD: false    # PR ìƒì„± ì‹œ í”„ë¡œì íŠ¸ ìë™ ì¶”ê°€
  ENABLE_PR_AUTO_CLOSE: false  # PR ë‹«ê¸° ì‹œ ì‘ì—… ì™„ë£Œ ì²˜ë¦¬

  # Status ê´€ë¦¬ ì˜µì…˜
  STATUS_PRIORITY: '["ì‘ì—…ì™„ë£Œ","ì·¨ì†Œ","í”¼ë“œë°±","ë‹´ë‹¹ìí™•ì¸","ì‘ì—…ì¤‘","ì‘ì—…ì „"]'  # Status Label ìš°ì„ ìˆœìœ„ (JSON ë°°ì—´)
  DONE_STATUS: "ì‘ì—…ì™„ë£Œ"      # Issue/PR ë‹«ê¸° ì‹œ ì„¤ì •í•  Status
  DEFAULT_STATUS: "ì‘ì—…ì „"     # Issue ìƒì„± ì‹œ ê¸°ë³¸ Status (ì„ íƒì , actions/add-to-projectê°€ ìë™ ì„¤ì •)

permissions:
  issues: write
  pull-requests: write
  contents: read

# ===================================================================
# Concurrency ì„¤ì •: ë™ì¼ Issue/PRì— ëŒ€í•´ í•˜ë‚˜ì˜ ì›Œí¬í”Œë¡œìš°ë§Œ ì‹¤í–‰
# labeled + unlabeled ì´ë²¤íŠ¸ê°€ ë™ì‹œì— ë°œìƒí•  ë•Œ Race Condition ë°©ì§€
# ===================================================================
concurrency:
  group: label-sync-${{ github.event.issue.number || github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  # ===================================================================
  # Job 1: Issue/PR ìƒì„± ì‹œ í”„ë¡œì íŠ¸ì— ìë™ ì¶”ê°€
  # ===================================================================
  add-to-project:
    name: í”„ë¡œì íŠ¸ì— Issue/PR ì¶”ê°€
    if: |
      github.event.action == 'opened' &&
      (
        github.event_name == 'issues' ||
        (github.event_name == 'pull_request' && false)
      )
    runs-on: ubuntu-latest
    steps:
      - name: í”„ë¡œì íŠ¸ì— Issue/PR ì¶”ê°€
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: ${{ env.PROJECT_URL }}
          github-token: ${{ secrets._GITHUB_PAT_TOKEN }}

      - name: ì¶”ê°€ ì™„ë£Œ ë¡œê·¸
        run: |
          if [ "${{ github.event_name }}" == "issues" ]; then
            echo "âœ… Issueê°€ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤."
            echo "  â€¢ ë²ˆí˜¸: #${{ github.event.issue.number }}"
          else
            echo "âœ… PRì´ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. (ENABLE_PR_AUTO_ADD: true)"
            echo "  â€¢ ë²ˆí˜¸: #${{ github.event.pull_request.number }}"
          fi
          echo "  â€¢ í”„ë¡œì íŠ¸: ${{ env.PROJECT_URL }}"

  # ===================================================================
  # Job 2: Label ë³€ê²½ ì‹œ Projects Status ë™ê¸°í™”
  # ===================================================================
  sync-label-to-status:
    name: Labelì„ Projects Statusë¡œ ë™ê¸°í™”
    if: |
      github.event_name == 'issues' &&
      (github.event.action == 'labeled' || github.event.action == 'unlabeled')
    runs-on: ubuntu-latest
    steps:
      - name: í˜„ì¬ Issueì˜ ëª¨ë“  Label ì¡°íšŒ
        id: get-labels
        uses: actions/github-script@v7
        env:
          STATUS_PRIORITY: ${{ env.STATUS_PRIORITY }}
        with:
          github-token: ${{ secrets._GITHUB_PAT_TOKEN }}
          script: |
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ“‹ Label ì¡°íšŒ ì‹œì‘');
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

            const statusPriority = JSON.parse(process.env.STATUS_PRIORITY || '[]');
            const action = context.payload.action;

            // ===== labeled ì´ë²¤íŠ¸: ì¶”ê°€ëœ ë¼ë²¨ì´ Status ë¼ë²¨ì´ë©´ ë°”ë¡œ ë°˜í™˜ =====
            // API ì¡°íšŒ ì—†ì´ payloadì—ì„œ ì§ì ‘ ë¼ë²¨ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ Race Condition ë°©ì§€
            if (action === 'labeled') {
              const addedLabel = context.payload.label.name;
              console.log(`ğŸ“Œ labeled ì´ë²¤íŠ¸ ê°ì§€: "${addedLabel}" ì¶”ê°€ë¨`);

              if (statusPriority.includes(addedLabel)) {
                console.log(`âœ… ì¶”ê°€ëœ ë¼ë²¨ì´ Status ë¼ë²¨ì…ë‹ˆë‹¤. API ì¡°íšŒ ì—†ì´ ì‚¬ìš©`);
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                return [addedLabel];
              }
              console.log(`â„¹ï¸ ì¶”ê°€ëœ ë¼ë²¨ì´ Status ë¼ë²¨ì´ ì•„ë‹™ë‹ˆë‹¤. API ì¡°íšŒ ì§„í–‰`);
            }

            // ===== unlabeled ì´ë²¤íŠ¸: ì œê±°ëœ ë¼ë²¨ì´ Status ë¼ë²¨ì´ ì•„ë‹ˆë©´ ê±´ë„ˆëœ€ =====
            if (action === 'unlabeled') {
              const removedLabel = context.payload.label.name;
              console.log(`ğŸ“Œ unlabeled ì´ë²¤íŠ¸ ê°ì§€: "${removedLabel}" ì œê±°ë¨`);

              if (!statusPriority.includes(removedLabel)) {
                console.log(`â„¹ï¸ ì œê±°ëœ ë¼ë²¨ì´ Status ë¼ë²¨ì´ ì•„ë‹™ë‹ˆë‹¤. ê±´ë„ˆëœ€`);
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                return [];
              }
            }

            // ===== APIë¡œ í˜„ì¬ ë¼ë²¨ ì¡°íšŒ (unlabeled ë˜ëŠ” ë¹„-Status ë¼ë²¨ì¸ ê²½ìš°) =====
            const issue = await github.rest.issues.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number
            });

            const labels = issue.data.labels.map(label => label.name);
            console.log(`ğŸ“Œ Issue #${context.issue.number}ì˜ í˜„ì¬ Labels:`);
            console.log(`  ${labels.join(', ') || '(ì—†ìŒ)'}`);
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

            return labels;

      - name: Statusë¡œ ë§¤í•‘í•  Label ê²°ì •
        id: determine-status
        uses: actions/github-script@v7
        env:
          STATUS_PRIORITY: ${{ env.STATUS_PRIORITY }}
        with:
          github-token: ${{ secrets._GITHUB_PAT_TOKEN }}
          script: |
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ¯ Status ê²°ì • ì‹œì‘');
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

            // ===== 1. Labels ë°°ì—´ ê²€ì¦ ë° ì •ì œ =====
            let labels = ${{ steps.get-labels.outputs.result }};

            if (!Array.isArray(labels)) {
              console.error('âŒ labelsê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤. ë¹ˆ ë°°ì—´ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.');
              console.error(`   ì‹¤ì œ íƒ€ì…: ${typeof labels}`);
              console.error(`   ì‹¤ì œ ê°’: ${JSON.stringify(labels)}`);
              labels = [];
            }

            // ìœ íš¨í•˜ì§€ ì•Šì€ Label í•„í„°ë§ (null, undefined, ë¹ˆ ë¬¸ìì—´, ë¹„ë¬¸ìì—´ ì œê±°)
            const originalLabelCount = labels.length;
            labels = labels.filter(label => {
              if (typeof label !== 'string') {
                console.warn(`âš ï¸ ë¹„ë¬¸ìì—´ Label ì œê±°ë¨ (íƒ€ì…: ${typeof label}, ê°’: ${JSON.stringify(label)})`);
                return false;
              }
              if (label.trim() === '') {
                console.warn('âš ï¸ ë¹ˆ ë¬¸ìì—´ Label ì œê±°ë¨');
                return false;
              }
              return true;
            });

            if (labels.length < originalLabelCount) {
              console.log(`ğŸ§¹ ìœ íš¨í•˜ì§€ ì•Šì€ Label ${originalLabelCount - labels.length}ê°œ ì œê±°ë¨`);
            }

            console.log(`ğŸ“Œ ìœ íš¨í•œ Label ê°œìˆ˜: ${labels.length}`);

            // ===== 2. Status ìš°ì„ ìˆœìœ„ ë°°ì—´ ê²€ì¦ ë° ì •ì œ =====
            let statusPriority;
            try {
              const statusPriorityEnv = process.env.STATUS_PRIORITY || '["ì‘ì—… ì™„ë£Œ","ì·¨ì†Œ","í”¼ë“œë°±","í™•ì¸ ëŒ€ê¸°","ì‘ì—… ì¤‘","ì‘ì—… ì „"]';
              statusPriority = JSON.parse(statusPriorityEnv);

              // ë°°ì—´ íƒ€ì… ê²€ì¦
              if (!Array.isArray(statusPriority)) {
                throw new Error(`STATUS_PRIORITY must be an array (actual type: ${typeof statusPriority})`);
              }

              // ë¹ˆ ë°°ì—´ ê²€ì¦
              if (statusPriority.length === 0) {
                throw new Error('STATUS_PRIORITY must be a non-empty array');
              }

              // ê° ìš”ì†Œê°€ ìœ íš¨í•œ ë¬¸ìì—´ì¸ì§€ ê²€ì¦ ë° í•„í„°ë§
              const originalPriorityCount = statusPriority.length;
              statusPriority = statusPriority.filter(item => {
                if (typeof item !== 'string') {
                  console.warn(`âš ï¸ STATUS_PRIORITYì—ì„œ ë¹„ë¬¸ìì—´ ìš”ì†Œ ì œê±°ë¨ (íƒ€ì…: ${typeof item}, ê°’: ${JSON.stringify(item)})`);
                  return false;
                }
                if (item.trim() === '') {
                  console.warn('âš ï¸ STATUS_PRIORITYì—ì„œ ë¹ˆ ë¬¸ìì—´ ìš”ì†Œ ì œê±°ë¨');
                  return false;
                }
                return true;
              });

              // í•„í„°ë§ í›„ ë¹ˆ ë°°ì—´ì¸ì§€ ì¬ê²€ì¦
              if (statusPriority.length === 0) {
                throw new Error('STATUS_PRIORITY must contain at least one non-empty string');
              }

              // ìœ íš¨í•˜ì§€ ì•Šì€ ìš”ì†Œ ì œê±° ì•Œë¦¼
              if (statusPriority.length < originalPriorityCount) {
                console.warn(`âš ï¸ STATUS_PRIORITYì—ì„œ ìœ íš¨í•˜ì§€ ì•Šì€ ê°’ ${originalPriorityCount - statusPriority.length}ê°œ ì œê±°ë¨`);
              }

              console.log(`ğŸ“Š ì„¤ì •ëœ Status ìš°ì„ ìˆœìœ„: ${statusPriority.join(' > ')}`);

            } catch (error) {
              console.error(`âŒ STATUS_PRIORITY íŒŒì‹±/ê²€ì¦ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©: ${error.message}`);
              statusPriority = ['ì‘ì—… ì™„ë£Œ','ì·¨ì†Œ','í”¼ë“œë°±','í™•ì¸ ëŒ€ê¸°','ì‘ì—… ì¤‘','ì‘ì—… ì „'];
              console.log(`ğŸ“Š ê¸°ë³¸ Status ìš°ì„ ìˆœìœ„: ${statusPriority.join(' > ')}`);
            }

            // ===== 3. í˜„ì¬ Label ì¤‘ Status Label ì°¾ê¸° (ëª¨ë“  ë§¤ì¹­ ì¶”ì ) =====
            const foundStatusLabels = [];
            let targetStatus = '';

            for (const status of statusPriority) {
              if (labels.includes(status)) {
                foundStatusLabels.push(status);
                // ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ ê²ƒë§Œ targetStatusë¡œ ì„¤ì •
                if (!targetStatus) {
                  targetStatus = status;
                }
              }
            }

            // ===== 4. ê²°ê³¼ ë¡œê¹… (ì—¬ëŸ¬ Status Labelì´ ìˆì„ ê²½ìš° ëª…ì‹œì  ì•Œë¦¼) =====
            if (foundStatusLabels.length === 0) {
              console.log('âš ï¸ Status Labelì´ ì—†ìŠµë‹ˆë‹¤. Status ì—…ë°ì´íŠ¸ ê±´ë„ˆëœ€');
            } else if (foundStatusLabels.length === 1) {
              console.log(`âœ… Status Label ë°œê²¬: "${targetStatus}"`);
              console.log(`ğŸ¯ Projects Statusë¡œ ì„¤ì •í•  ê°’: "${targetStatus}"`);
            } else {
              // ì—¬ëŸ¬ Status Labelì´ ë™ì‹œì— ì¡´ì¬í•˜ëŠ” ê²½ìš°
              console.log(`âš ï¸ ì—¬ëŸ¬ ê°œì˜ Status Labelì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤:`);
              console.log(`   ë°œê²¬ëœ Labels: ${foundStatusLabels.join(', ')}`);
              console.log(`   ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì„ íƒëœ Label: "${targetStatus}"`);
              console.log(`   ë¬´ì‹œëœ Labels: ${foundStatusLabels.slice(1).join(', ')}`);
              console.log(`ğŸ¯ Projects Statusë¡œ ì„¤ì •í•  ê°’: "${targetStatus}"`);
              console.log('');
              console.log('ğŸ’¡ ê¶Œì¥ì‚¬í•­: í•˜ë‚˜ì˜ Issueì—ëŠ” í•˜ë‚˜ì˜ Status Labelë§Œ ì‚¬ìš©í•˜ì„¸ìš”.');
            }

            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

            return targetStatus;

      - name: Projects Status ì—…ë°ì´íŠ¸
        if: steps.determine-status.outputs.result != ''
        uses: actions/github-script@v7
        env:
          TARGET_STATUS: ${{ fromJSON(steps.determine-status.outputs.result) }}
        with:
          github-token: ${{ secrets._GITHUB_PAT_TOKEN }}
          script: |
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ”„ Projects Status ì—…ë°ì´íŠ¸ ì‹œì‘');
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

            const targetStatus = process.env.TARGET_STATUS;
            const issueNodeId = context.payload.issue.node_id;
            const projectUrl = '${{ env.PROJECT_URL }}';

            console.log(`ğŸ“Œ Issue Node ID: ${issueNodeId}`);
            console.log(`ğŸ“Œ ëª©í‘œ Status: "${targetStatus}"`);
            console.log(`ğŸ“Œ í”„ë¡œì íŠ¸ URL: ${projectUrl}`);

            try {
              // 1. í”„ë¡œì íŠ¸ ë²ˆí˜¸ ì¶”ì¶œ
              const projectMatch = projectUrl.match(/\/projects\/(\d+)/);
              if (!projectMatch) {
                throw new Error('í”„ë¡œì íŠ¸ URLì—ì„œ ë²ˆí˜¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
              }
              const projectNumber = parseInt(projectMatch[1]);
              console.log(`ğŸ“Š í”„ë¡œì íŠ¸ ë²ˆí˜¸: ${projectNumber}`);

              // 2. ì¡°ì§ í”„ë¡œì íŠ¸ ì •ë³´ ì¡°íšŒ
              const orgLogin = context.repo.owner;
              console.log(`ğŸ¢ ì¡°ì§ëª…: ${orgLogin}`);

              const projectQuery = `
                query($orgLogin: String!, $projectNumber: Int!) {
                  organization(login: $orgLogin) {
                    projectV2(number: $projectNumber) {
                      id
                      fields(first: 20) {
                        nodes {
                          ... on ProjectV2SingleSelectField {
                            id
                            name
                            options {
                              id
                              name
                            }
                          }
                        }
                      }
                    }
                  }
                }
              `;

              const projectData = await github.graphql(projectQuery, {
                orgLogin,
                projectNumber
              });

              const project = projectData.organization.projectV2;
              const projectId = project.id;
              console.log(`âœ… í”„ë¡œì íŠ¸ ID: ${projectId}`);

              // 3. Status í•„ë“œ ë° ì˜µì…˜ ID ì°¾ê¸°
              const statusField = project.fields.nodes.find(
                field => field.name === '${{ env.STATUS_FIELD }}'
              );

              if (!statusField) {
                throw new Error('Status í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
              }

              const fieldId = statusField.id;
              console.log(`âœ… Status í•„ë“œ ID: ${fieldId}`);

              const statusOption = statusField.options.find(
                option => option.name === targetStatus
              );

              if (!statusOption) {
                throw new Error(`"${targetStatus}" ì˜µì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
              }

              const optionId = statusOption.id;
              console.log(`âœ… "${targetStatus}" ì˜µì…˜ ID: ${optionId}`);

              // 4. Issueì˜ í”„ë¡œì íŠ¸ ì•„ì´í…œ ID ì¡°íšŒ
              const itemQuery = `
                query($issueId: ID!) {
                  node(id: $issueId) {
                    ... on Issue {
                      projectItems(first: 10) {
                        nodes {
                          id
                          project {
                            id
                          }
                        }
                      }
                    }
                  }
                }
              `;

              const itemData = await github.graphql(itemQuery, {
                issueId: issueNodeId
              });

              const projectItem = itemData.node.projectItems.nodes.find(
                item => item.project.id === projectId
              );

              if (!projectItem) {
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('âš ï¸ ì´ Issueê°€ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('');
                console.log('ğŸ“‹ í˜„ì¬ ìƒíƒœ:');
                console.log(`  â€¢ Issue ë²ˆí˜¸: #${context.issue.number}`);
                console.log(`  â€¢ í”„ë¡œì íŠ¸: ${projectUrl}`);
                console.log(`  â€¢ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë¨: âŒ ì•„ë‹ˆì˜¤`);
                console.log('');
                console.log('ğŸ’¡ ê°€ëŠ¥í•œ ì›ì¸:');
                console.log('  1. Issueê°€ ìƒì„±ëœ ì§í›„ ì•„ì§ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë˜ì§€ ì•ŠìŒ');
                console.log('  2. add-to-project Jobì´ ì‹¤íŒ¨í–ˆê±°ë‚˜ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ');
                console.log('  3. Issueê°€ ìˆ˜ë™ìœ¼ë¡œ í”„ë¡œì íŠ¸ì—ì„œ ì œê±°ë¨');
                console.log('  4. í”„ë¡œì íŠ¸ URLì´ ì˜ëª» ì„¤ì •ë¨');
                console.log('');
                console.log('ğŸ”§ í•´ê²° ë°©ë²•:');
                console.log('  1. í”„ë¡œì íŠ¸ í˜ì´ì§€ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ Issueë¥¼ ì¶”ê°€í•˜ì„¸ìš”.');
                console.log('  2. Issue Labelì„ ë‹¤ì‹œ ë³€ê²½í•˜ì—¬ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¬ì‹¤í–‰í•˜ì„¸ìš”.');
                console.log('  3. ì›Œí¬í”Œë¡œìš° ë¡œê·¸ì—ì„œ add-to-project Job ì‹¤í–‰ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                console.log('  4. í™˜ê²½ë³€ìˆ˜ PROJECT_URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                console.log('');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                return;
              }

              const itemId = projectItem.id;
              console.log(`âœ… í”„ë¡œì íŠ¸ ì•„ì´í…œ ID: ${itemId}`);

              // 5. Status ì—…ë°ì´íŠ¸ ë®¤í…Œì´ì…˜ ì‹¤í–‰
              const updateMutation = `
                mutation($projectId: ID!, $itemId: ID!, $fieldId: ID!, $optionId: String!) {
                  updateProjectV2ItemFieldValue(
                    input: {
                      projectId: $projectId
                      itemId: $itemId
                      fieldId: $fieldId
                      value: { singleSelectOptionId: $optionId }
                    }
                  ) {
                    projectV2Item {
                      id
                    }
                  }
                }
              `;

              await github.graphql(updateMutation, {
                projectId,
                itemId,
                fieldId,
                optionId
              });

              console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
              console.log('ğŸ‰ Projects Status ì—…ë°ì´íŠ¸ ì™„ë£Œ!');
              console.log(`  â€¢ Issue: #${context.issue.number}`);
              console.log(`  â€¢ Status: "${targetStatus}"`);
              console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

            } catch (error) {
              console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
              console.error('âŒ Status ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
              console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

              // ì—ëŸ¬ íƒ€ì… ë¶„ì„ ë° ìƒì„¸ ì•ˆë‚´
              const errorMessage = error.message || JSON.stringify(error);
              const errorStatus = error.status || (error.response && error.response.status);

              if (errorStatus === 401 || errorMessage.includes('401') || errorMessage.includes('Unauthorized')) {
                // ì¸ì¦ ì˜¤ë¥˜
                console.error('ğŸ” ì¸ì¦ ì˜¤ë¥˜ (401 Unauthorized)');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  1. _GITHUB_PAT_TOKEN Secretì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                console.error('  2. PAT í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.error('  3. PAT í† í°ì— í•„ìš”í•œ ê¶Œí•œ(repo, project)ì´ ì—†ìŠµë‹ˆë‹¤.');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error('  1. GitHub Settings > Developer settings > Personal access tokens');
                console.error('  2. Classic PAT ìƒì„± (Fine-grained tokenì€ GraphQL ë¯¸ì§€ì›)');
                console.error('  3. ê¶Œí•œ ë¶€ì—¬: repo (ì „ì²´), project (read:project, write:project)');
                console.error('  4. Organization Secretsì— _GITHUB_PAT_TOKENìœ¼ë¡œ ë“±ë¡');

              } else if (errorStatus === 404 || errorMessage.includes('404') || errorMessage.includes('Not Found')) {
                // ë¦¬ì†ŒìŠ¤ ì°¾ì„ ìˆ˜ ì—†ìŒ
                console.error('ğŸ” ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (404 Not Found)');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  1. í”„ë¡œì íŠ¸ URLì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.error('  2. STATUS_FIELD ì´ë¦„ì´ í”„ë¡œì íŠ¸ í•„ë“œëª…ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                console.error('  3. ì„¤ì •í•˜ë ¤ëŠ” Status ê°’ì´ í”„ë¡œì íŠ¸ì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                console.error('  4. PAT í† í°ì— í•´ë‹¹ í”„ë¡œì íŠ¸ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error(`  1. í”„ë¡œì íŠ¸ URL í™•ì¸: ${projectUrl}`);
                console.error(`  2. Status í•„ë“œëª… í™•ì¸: "${{ env.STATUS_FIELD }}"`);
                console.error(`  3. Status ì˜µì…˜ í™•ì¸: "${targetStatus}"`);
                console.error('  4. PAT í† í°ì´ í•´ë‹¹ Organizationì— ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸');

              } else if (errorMessage.includes('rate limit') || errorMessage.includes('abuse') || errorMessage.includes('429')) {
                // Rate Limiting
                console.error('â±ï¸ API Rate Limit ì´ˆê³¼ (429 Too Many Requests)');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  GitHub API í˜¸ì¶œ íšŸìˆ˜ ì œí•œì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.');
                console.error('  (ì‹œê°„ë‹¹ 5000 ìš”ì²­ ì œí•œ)');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error('  1. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
                console.error('  2. ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° ë¹ˆë„ë¥¼ ì¤„ì´ì„¸ìš”.');
                console.error('  3. GitHub API Rate Limit ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.');

              } else if (errorMessage.includes('ETIMEDOUT') || errorMessage.includes('ECONNREFUSED') || errorMessage.includes('network')) {
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
                console.error('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  GitHub API ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error('  1. GitHub ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”: https://www.githubstatus.com');
                console.error('  2. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
                console.error('  3. ì›Œí¬í”Œë¡œìš°ê°€ ìë™ìœ¼ë¡œ ì¬ì‹œë„ë©ë‹ˆë‹¤.');

              } else if (errorMessage.includes('Cannot be updated') || errorMessage.includes('Field cannot be updated')) {
                // í•„ë“œ ì—…ë°ì´íŠ¸ ë¶ˆê°€
                console.error('ğŸš« í•„ë“œ ì—…ë°ì´íŠ¸ ë¶ˆê°€');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  í•´ë‹¹ í•„ë“œëŠ” GraphQL APIë¡œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                console.error('  (Labels, Assignees, Milestone ë“±ì€ ë®¤í…Œì´ì…˜ ë¯¸ì§€ì›)');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error('  1. STATUS_FIELDê°€ Single Select íƒ€ì…ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                console.error('  2. í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ í•„ë“œ íƒ€ì…ì„ í™•ì¸í•˜ì„¸ìš”.');

              } else {
                // ê¸°íƒ€ ì˜¤ë¥˜
                console.error('â“ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                console.error('');
                console.error('ìƒì„¸ ì •ë³´:');
              }

              console.error('');
              console.error('ì „ì²´ ì—ëŸ¬ ë©”ì‹œì§€:');
              console.error(errorMessage);
              if (error.stack) {
                console.error('');
                console.error('Stack Trace:');
                console.error(error.stack);
              }
              console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

              throw error;
            }

  # ===================================================================
  # Job 3: Issue/PR ë‹«ê¸° ì‹œ "ì‘ì—… ì™„ë£Œ" Statusë¡œ ë³€ê²½
  # ===================================================================
  move-closed-to-done:
    name: ë‹«íŒ Issue/PRì„ ì‘ì—… ì™„ë£Œë¡œ ì´ë™
    if: |
      github.event.action == 'closed' &&
      (
        github.event_name == 'issues' ||
        (github.event_name == 'pull_request' && false)
      )
    runs-on: ubuntu-latest
    steps:
      - name: Projects Statusë¥¼ "ì‘ì—… ì™„ë£Œ"ë¡œ ì—…ë°ì´íŠ¸
        uses: actions/github-script@v7
        env:
          DONE_STATUS: ${{ env.DONE_STATUS }}
        with:
          github-token: ${{ secrets._GITHUB_PAT_TOKEN }}
          script: |
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ Issue/PR ë‹«ê¸° ê°ì§€ - ì‘ì—… ì™„ë£Œ ì²˜ë¦¬');
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

            const targetStatus = process.env.DONE_STATUS || 'ì‘ì—… ì™„ë£Œ';
            const itemNodeId = context.payload.issue?.node_id || context.payload.pull_request?.node_id;
            const itemNumber = context.payload.issue?.number || context.payload.pull_request?.number;
            const itemType = context.payload.issue ? 'Issue' : 'Pull Request';
            const projectUrl = '${{ env.PROJECT_URL }}';

            console.log(`ğŸ“Œ ${itemType} #${itemNumber}`);
            console.log(`ğŸ“Œ Node ID: ${itemNodeId}`);
            console.log(`ğŸ“Œ ëª©í‘œ Status: "${targetStatus}"`);

            try {
              // 1. í”„ë¡œì íŠ¸ ë²ˆí˜¸ ì¶”ì¶œ
              const projectMatch = projectUrl.match(/\/projects\/(\d+)/);
              if (!projectMatch) {
                throw new Error('í”„ë¡œì íŠ¸ URLì—ì„œ ë²ˆí˜¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
              }
              const projectNumber = parseInt(projectMatch[1]);

              // 2. ì¡°ì§ í”„ë¡œì íŠ¸ ì •ë³´ ì¡°íšŒ
              const orgLogin = context.repo.owner;

              const projectQuery = `
                query($orgLogin: String!, $projectNumber: Int!) {
                  organization(login: $orgLogin) {
                    projectV2(number: $projectNumber) {
                      id
                      fields(first: 20) {
                        nodes {
                          ... on ProjectV2SingleSelectField {
                            id
                            name
                            options {
                              id
                              name
                            }
                          }
                        }
                      }
                    }
                  }
                }
              `;

              const projectData = await github.graphql(projectQuery, {
                orgLogin,
                projectNumber
              });

              const project = projectData.organization.projectV2;
              const projectId = project.id;

              // 3. Status í•„ë“œ ë° "ì‘ì—… ì™„ë£Œ" ì˜µì…˜ ID ì°¾ê¸°
              const statusField = project.fields.nodes.find(
                field => field.name === '${{ env.STATUS_FIELD }}'
              );

              if (!statusField) {
                throw new Error('Status í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
              }

              const fieldId = statusField.id;

              const doneOption = statusField.options.find(
                option => option.name === targetStatus
              );

              if (!doneOption) {
                throw new Error(`"${targetStatus}" ì˜µì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
              }

              const optionId = doneOption.id;
              console.log(`âœ… "${targetStatus}" ì˜µì…˜ ID: ${optionId}`);

              // 4. Issue/PRì˜ í”„ë¡œì íŠ¸ ì•„ì´í…œ ID ì¡°íšŒ
              const itemQuery = context.payload.issue
                ? `
                  query($itemId: ID!) {
                    node(id: $itemId) {
                      ... on Issue {
                        projectItems(first: 10) {
                          nodes {
                            id
                            project {
                              id
                            }
                          }
                        }
                      }
                    }
                  }
                `
                : `
                  query($itemId: ID!) {
                    node(id: $itemId) {
                      ... on PullRequest {
                        projectItems(first: 10) {
                          nodes {
                            id
                            project {
                              id
                            }
                          }
                        }
                      }
                    }
                  }
                `;

              const itemData = await github.graphql(itemQuery, {
                itemId: itemNodeId
              });

              const projectItem = itemData.node.projectItems.nodes.find(
                item => item.project.id === projectId
              );

              if (!projectItem) {
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log(`âš ï¸ ì´ ${itemType}ê°€ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('');
                console.log('ğŸ“‹ í˜„ì¬ ìƒíƒœ:');
                console.log(`  â€¢ ${itemType} ë²ˆí˜¸: #${itemNumber}`);
                console.log(`  â€¢ í”„ë¡œì íŠ¸: ${projectUrl}`);
                console.log(`  â€¢ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë¨: âŒ ì•„ë‹ˆì˜¤`);
                console.log('');
                console.log('ğŸ’¡ ê°€ëŠ¥í•œ ì›ì¸:');
                console.log('  1. ì´ Issue/PRì´ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                console.log('  2. add-to-project Jobì´ ì‹¤íŒ¨í–ˆê±°ë‚˜ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ');
                console.log('  3. ìˆ˜ë™ìœ¼ë¡œ í”„ë¡œì íŠ¸ì—ì„œ ì œê±°ë¨');
                console.log('  4. í”„ë¡œì íŠ¸ URLì´ ì˜ëª» ì„¤ì •ë¨');
                console.log('');
                console.log('ğŸ”§ í•´ê²° ë°©ë²•:');
                console.log('  1. í”„ë¡œì íŠ¸ í˜ì´ì§€ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€ í›„ Statusë¥¼ "ì‘ì—… ì™„ë£Œ"ë¡œ ë³€ê²½í•˜ì„¸ìš”.');
                console.log('  2. ì›Œí¬í”Œë¡œìš° ë¡œê·¸ì—ì„œ add-to-project Job ì‹¤í–‰ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                console.log('  3. í™˜ê²½ë³€ìˆ˜ PROJECT_URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                console.log('');
                console.log('â„¹ï¸ ìë™ ì™„ë£Œ ì²˜ë¦¬ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                return;
              }

              const itemId = projectItem.id;
              console.log(`âœ… í”„ë¡œì íŠ¸ ì•„ì´í…œ ID: ${itemId}`);

              // 5. Status ì—…ë°ì´íŠ¸ ë®¤í…Œì´ì…˜ ì‹¤í–‰
              const updateMutation = `
                mutation($projectId: ID!, $itemId: ID!, $fieldId: ID!, $optionId: String!) {
                  updateProjectV2ItemFieldValue(
                    input: {
                      projectId: $projectId
                      itemId: $itemId
                      fieldId: $fieldId
                      value: { singleSelectOptionId: $optionId }
                    }
                  ) {
                    projectV2Item {
                      id
                    }
                  }
                }
              `;

              await github.graphql(updateMutation, {
                projectId,
                itemId,
                fieldId,
                optionId
              });

              console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
              console.log('ğŸ‰ ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì„±ê³µ!');
              console.log(`  â€¢ ${itemType}: #${itemNumber}`);
              console.log(`  â€¢ Status: "${targetStatus}"`);
              console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

            } catch (error) {
              console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
              console.error('âŒ ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨');
              console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

              // ì—ëŸ¬ íƒ€ì… ë¶„ì„ ë° ìƒì„¸ ì•ˆë‚´
              const errorMessage = error.message || JSON.stringify(error);
              const errorStatus = error.status || (error.response && error.response.status);

              if (errorStatus === 401 || errorMessage.includes('401') || errorMessage.includes('Unauthorized')) {
                // ì¸ì¦ ì˜¤ë¥˜
                console.error('ğŸ” ì¸ì¦ ì˜¤ë¥˜ (401 Unauthorized)');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  1. _GITHUB_PAT_TOKEN Secretì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                console.error('  2. PAT í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.error('  3. PAT í† í°ì— í•„ìš”í•œ ê¶Œí•œ(repo, project)ì´ ì—†ìŠµë‹ˆë‹¤.');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error('  1. GitHub Settings > Developer settings > Personal access tokens');
                console.error('  2. Classic PAT ìƒì„± (Fine-grained tokenì€ GraphQL ë¯¸ì§€ì›)');
                console.error('  3. ê¶Œí•œ ë¶€ì—¬: repo (ì „ì²´), project (read:project, write:project)');
                console.error('  4. Organization Secretsì— _GITHUB_PAT_TOKENìœ¼ë¡œ ë“±ë¡');

              } else if (errorStatus === 404 || errorMessage.includes('404') || errorMessage.includes('Not Found')) {
                // ë¦¬ì†ŒìŠ¤ ì°¾ì„ ìˆ˜ ì—†ìŒ
                console.error('ğŸ” ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (404 Not Found)');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  1. í”„ë¡œì íŠ¸ URLì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.error('  2. STATUS_FIELD ì´ë¦„ì´ í”„ë¡œì íŠ¸ í•„ë“œëª…ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                console.error('  3. DONE_STATUS ê°’ì´ í”„ë¡œì íŠ¸ì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                console.error('  4. PAT í† í°ì— í•´ë‹¹ í”„ë¡œì íŠ¸ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error(`  1. í”„ë¡œì íŠ¸ URL í™•ì¸: ${projectUrl}`);
                console.error(`  2. Status í•„ë“œëª… í™•ì¸: "${{ env.STATUS_FIELD }}"`);
                console.error(`  3. DONE_STATUS í™•ì¸: "${targetStatus}"`);
                console.error('  4. PAT í† í°ì´ í•´ë‹¹ Organizationì— ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸');

              } else if (errorMessage.includes('rate limit') || errorMessage.includes('abuse') || errorMessage.includes('429')) {
                // Rate Limiting
                console.error('â±ï¸ API Rate Limit ì´ˆê³¼ (429 Too Many Requests)');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  GitHub API í˜¸ì¶œ íšŸìˆ˜ ì œí•œì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.');
                console.error('  (ì‹œê°„ë‹¹ 5000 ìš”ì²­ ì œí•œ)');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error('  1. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
                console.error('  2. ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° ë¹ˆë„ë¥¼ ì¤„ì´ì„¸ìš”.');
                console.error('  3. GitHub API Rate Limit ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.');

              } else if (errorMessage.includes('ETIMEDOUT') || errorMessage.includes('ECONNREFUSED') || errorMessage.includes('network')) {
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
                console.error('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  GitHub API ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error('  1. GitHub ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”: https://www.githubstatus.com');
                console.error('  2. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
                console.error('  3. ì›Œí¬í”Œë¡œìš°ê°€ ìë™ìœ¼ë¡œ ì¬ì‹œë„ë©ë‹ˆë‹¤.');

              } else if (errorMessage.includes('Cannot be updated') || errorMessage.includes('Field cannot be updated')) {
                // í•„ë“œ ì—…ë°ì´íŠ¸ ë¶ˆê°€
                console.error('ğŸš« í•„ë“œ ì—…ë°ì´íŠ¸ ë¶ˆê°€');
                console.error('');
                console.error('ì›ì¸:');
                console.error('  í•´ë‹¹ í•„ë“œëŠ” GraphQL APIë¡œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                console.error('  (Labels, Assignees, Milestone ë“±ì€ ë®¤í…Œì´ì…˜ ë¯¸ì§€ì›)');
                console.error('');
                console.error('í•´ê²° ë°©ë²•:');
                console.error('  1. STATUS_FIELDê°€ Single Select íƒ€ì…ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                console.error('  2. í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ í•„ë“œ íƒ€ì…ì„ í™•ì¸í•˜ì„¸ìš”.');

              } else {
                // ê¸°íƒ€ ì˜¤ë¥˜
                console.error('â“ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                console.error('');
                console.error('ìƒì„¸ ì •ë³´:');
              }

              console.error('');
              console.error('ì „ì²´ ì—ëŸ¬ ë©”ì‹œì§€:');
              console.error(errorMessage);
              if (error.stack) {
                console.error('');
                console.error('Stack Trace:');
                console.error(error.stack);
              }
              console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

              // ì‹¤íŒ¨í•´ë„ ì›Œí¬í”Œë¡œìš°ëŠ” ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬ (GitHub ê¸°ë³¸ ìë™í™”ê°€ ìˆì„ ìˆ˜ ìˆìŒ)
              console.log('');
              console.log('âš ï¸ GitHub Projects ê¸°ë³¸ ìë™í™”ê°€ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.');
              console.log('   Projects > Workflows ë©”ë‰´ì—ì„œ "Item closed" ìë™í™”ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
            }
